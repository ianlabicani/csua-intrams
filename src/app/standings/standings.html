<div class="max-w-6xl mx-auto p-6 space-y-14 page-shell">
  <!-- Scrolling college logos banner -->
  <div class="logo-marquee" aria-label="Participating Colleges">
    <div class="marquee-track">
      @for (c of colleges(); track c.id) { @if (c.photo_url) {
      <div class="logo-item" title="{{c.name}}">
        <img [src]="c.photo_url" alt="{{c.name}}" loading="lazy" />
      </div>
      } } @for (c of colleges(); track 'dup-' + c.id) { @if (c.photo_url) {
      <div class="logo-item" title="{{c.name}}">
        <img [src]="c.photo_url" alt="{{c.name}}" loading="lazy" />
      </div>
      } }
    </div>
  </div>
  <!-- Points-Based Overall Ranking -->
  <div class="space-y-3">
    <h1
      class="text-4xl font-extrabold text-center gradient-title tracking-tight"
    >
      Overall Points Ranking
    </h1>
    <p class="text-center text-sm text-slate-500">
      Total points from all scored events (5 / 3 / 1 system)
    </p>
    <div class="overflow-x-auto modern-card">
      <table class="min-w-full text-sm text-gray-700 table-modern stack-mobile">
        <thead class="bg-indigo-50/70 text-gray-800 text-xs uppercase">
          <tr>
            <th class="text-left p-3">Rank</th>
            <th class="text-left p-3">College</th>
            <th class="p-3 text-center">ðŸ¥‡</th>
            <th class="p-3 text-center">ðŸ¥ˆ</th>
            <th class="p-3 text-center">ðŸ¥‰</th>
            <th class="p-3 text-center">Total Points</th>
          </tr>
        </thead>
        <tbody>
          @for (item of pointsRows(); track item.id) {
          <tr
            class="border-t hover:bg-gray-50 transition"
            [class.bg-yellow-50]="item.rank === 1 && item.points > 0"
            [class.rank-row-2]="item.rank === 2 && item.points > 0"
            [class.bg-orange-50]="item.rank === 3 && item.points > 0"
          >
            <td class="p-3" data-label="Rank">
              <span
                class="rank-badge rank-{{item.rank}}"
                [class.rank-1]="item.rank===1"
                [class.rank-2]="item.rank===2"
                [class.rank-3]="item.rank===3"
                >{{ item.rank }}</span
              >
            </td>
            <td class="p-3 flex items-center gap-2" data-label="College">
              @if (item.photo_url) {
              <img
                [src]="item.photo_url"
                alt="{{item.name}}"
                class="w-10 h-10 rounded-full object-cover ring-2 ring-white shadow-sm"
              />
              }
              <span>{{ item.name }}</span>
            </td>

            <td
              class="text-center p-3 font-semibold text-yellow-600"
              [countAnim]="item.gold"
              data-label="Gold"
            ></td>
            <td
              class="text-center p-3 font-semibold text-gray-500"
              [countAnim]="item.silver"
              data-label="Silver"
            ></td>
            <td
              class="text-center p-3 font-semibold text-orange-600"
              [countAnim]="item.bronze"
              data-label="Bronze"
            ></td>
            <td
              class="text-center p-3 font-bold text-indigo-700"
              [countAnim]="item.points"
              [countAnimDuration]="700"
              data-label="Points"
            ></td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Medal Standings (by medal hierarchy) -->
  <div class="space-y-3">
    <h2 class="text-3xl font-bold text-center sub-gradient-title">
      Medal Standings
    </h2>
    <p class="text-center text-xs text-slate-500">
      Sorted by ðŸ¥‡ then ðŸ¥ˆ then ðŸ¥‰
    </p>
    <div class="overflow-x-auto modern-card">
      <table class="min-w-full text-sm text-gray-700 table-modern stack-mobile">
        <thead class="bg-gray-100/70 text-gray-800 text-xs uppercase">
          <tr>
            <th class="text-left p-3">Rank</th>
            <th class="text-left p-3">College</th>
            <th class="p-3 text-center">ðŸ¥‡</th>
            <th class="p-3 text-center">ðŸ¥ˆ</th>
            <th class="p-3 text-center">ðŸ¥‰</th>
            <th class="p-3 text-center">Medal Sum</th>
          </tr>
        </thead>
        <tbody>
          @for (item of rows(); track item.id) {
          <tr
            class="border-t hover:bg-gray-50 transition"
            [class.bg-yellow-50]="item.rank === 1 && (item.gold || item.silver || item.bronze) > 0"
            [class.rank-row-2]="item.rank === 2 && (item.gold || item.silver || item.bronze) > 0"
            [class.bg-orange-50]="item.rank === 3 && (item.gold || item.silver || item.bronze) > 0"
          >
            <td class="p-3" data-label="Rank">
              <span
                class="rank-badge rank-{{item.rank}}"
                [class.rank-1]="item.rank===1"
                [class.rank-2]="item.rank===2"
                [class.rank-3]="item.rank===3"
                >{{ item.rank }}</span
              >
            </td>
            <td class="p-3 flex items-center gap-2" data-label="College">
              @if (item.photo_url) {
              <img
                [src]="item.photo_url"
                alt="{{item.name}}"
                class="w-10 h-10 rounded-full object-cover ring-2 ring-white shadow-sm"
              />
              }
              <span>{{ item.name }}</span>
            </td>
            <td
              class="text-center p-3 font-semibold text-yellow-600"
              [countAnim]="item.gold"
              data-label="Gold"
            ></td>
            <td
              class="text-center p-3 font-semibold text-gray-500"
              [countAnim]="item.silver"
              data-label="Silver"
            ></td>
            <td
              class="text-center p-3 font-semibold text-orange-600"
              [countAnim]="item.bronze"
              data-label="Bronze"
            ></td>
            <td
              class="text-center p-3 font-bold text-indigo-700"
              [countAnim]="item.total"
              data-label="Total"
            ></td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Collapsible Categories / Events -->
  <div class="space-y-4">
    <h2 class="text-3xl font-bold text-center sub-gradient-title">
      Finished Events
    </h2>
    <p class="text-center text-sm text-slate-500">
      View results from completed competitions by category
    </p>
    <div class="flex gap-2">
      <button
        (click)="expandAllCategories()"
        class="px-3 py-1 text-sm border rounded bg-white hover:bg-gray-50"
      >
        Expand All
      </button>
      <button
        (click)="collapseAllCategories()"
        class="px-3 py-1 text-sm border rounded bg-white hover:bg-gray-50"
      >
        Collapse All
      </button>
    </div>
    @for (cat of categories(); track cat.category) {
    <div class="modern-card">
      <button
        type="button"
        (click)="toggleCategory(cat.category)"
        class="w-full flex items-center justify-between px-4 py-3 text-left font-semibold hover:bg-gray-50 category-header"
      >
        <span>{{ cat.category }}</span>
        <span class="text-xs text-gray-500"
          >{{ cat.events.length }} events</span
        >
      </button>
      @if (isCategoryOpen(cat.category)) {
      <div class="border-t">
        @for (ev of cat.events; track ev.name) {
        <div class="border-b last:border-b-0 event-row">
          <button
            type="button"
            (click)="toggleEvent(ev.name)"
            class="w-full flex items-center justify-between px-6 py-2 text-left text-sm hover:bg-gray-50 transition-colors border-l-4 border-transparent"
            [class.bg-indigo-50]="isEventOpen(ev.name)"
            [class.border-indigo-500]="isEventOpen(ev.name)"
            [class.font-semibold]="isEventOpen(ev.name)"
          >
            <span class="font-medium">{{ ev.name }}</span>
            <span class="text-xs text-gray-400"
              >{{ ev.rows.length }} entries</span
            >
          </button>
          @if (isEventOpen(ev.name)) {
          <div class="px-6 pb-4 overflow-x-auto modern-card mt-2">
            <table class="min-w-full text-xs table-modern stack-mobile">
              <thead class="bg-gray-100/70 text-gray-600 uppercase">
                <tr>
                  <th class="p-2 text-left">Rank</th>
                  <th class="p-2 text-left">College</th>
                  <th class="p-2 text-center">ðŸ¥‡</th>
                  <th class="p-2 text-center">ðŸ¥ˆ</th>
                  <th class="p-2 text-center">ðŸ¥‰</th>
                  <th class="p-2 text-center">Points</th>
                </tr>
              </thead>
              <tbody>
                @for (row of ev.rows; track row.collegeId) {
                <tr class="border-t hover:bg-gray-50">
                  <td class="p-2 font-semibold" data-label="Rank">
                    {{ row.rank }}
                  </td>
                  <td class="p-2" data-label="College">{{ row.college }}</td>
                  <td
                    class="p-2 text-center text-yellow-600"
                    [countAnim]="row.gold"
                    data-label="Gold"
                  ></td>
                  <td
                    class="p-2 text-center text-gray-500"
                    [countAnim]="row.silver"
                    data-label="Silver"
                  ></td>
                  <td
                    class="p-2 text-center text-orange-600"
                    [countAnim]="row.bronze"
                    data-label="Bronze"
                  ></td>
                  <td
                    class="p-2 text-center font-semibold"
                    [countAnim]="row.points"
                    data-label="Points"
                  ></td>
                </tr>
                }
              </tbody>
            </table>
          </div>
          }
        </div>
        }
      </div>
      }
    </div>
    }
  </div>
</div>
<div class="mt-2 mb-4 toolbar">
  @if (!auth.currentUser) {
  <a
    routerLink="/login"
    class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg font-semibold shadow"
    >Admin Login</a
  >
  } @else {
  <a
    routerLink="/admin"
    class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg font-semibold shadow"
    >Admin Dashboard</a
  >
  }
</div>

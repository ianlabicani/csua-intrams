<div class="max-w-6xl mx-auto p-6 space-y-14 page-shell">
  <div class="mt-2 mb-4 toolbar">
    @if (!auth.currentUser) {
    <a
      routerLink="/login"
      class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg font-semibold shadow"
      >Admin Login</a
    >
    } @else {
    <a
      routerLink="/admin"
      class="bg-pink-600 hover:bg-pink-700 text-white px-4 py-2 rounded-lg font-semibold shadow"
      >Admin Dashboard</a
    >
    }
  </div>

  <!-- Points-Based Overall Ranking -->
  <div class="space-y-3">
    <h1
      class="text-4xl font-extrabold text-center gradient-title tracking-tight"
    >
      Overall Points Ranking
    </h1>
    <p class="text-center text-sm text-slate-500">
      Total points from all scored events (5 / 3 / 1 system)
    </p>
    <div class="overflow-x-auto modern-card">
      <table class="min-w-full text-sm text-gray-700 table-modern">
        <thead class="bg-indigo-50/70 text-gray-800 text-xs uppercase">
          <tr>
            <th class="text-left p-3">Rank</th>
            <th class="text-left p-3">College</th>
            <th class="p-3 text-center">Total Points</th>
            <th class="p-3 text-center">ðŸ¥‡</th>
            <th class="p-3 text-center">ðŸ¥ˆ</th>
            <th class="p-3 text-center">ðŸ¥‰</th>
          </tr>
        </thead>
        <tbody>
          @for (item of pointsRows(); track item.id) {
          <tr
            class="border-t hover:bg-gray-50 transition"
            [class.bg-yellow-50]="item.rank === 1"
            [class.bg-gray-50]="item.rank === 2"
            [class.bg-orange-50]="item.rank === 3"
          >
            <td class="p-3">
              <span
                class="rank-badge rank-{{item.rank}}"
                [class.rank-1]="item.rank===1"
                [class.rank-2]="item.rank===2"
                [class.rank-3]="item.rank===3"
                >{{ item.rank }}</span
              >
            </td>
            <td class="p-3 flex items-center gap-2">
              <span
                class="w-3 h-3 rounded-full"
                [style.background]="item.color"
              ></span>
              {{ item.name }}
            </td>
            <td
              class="text-center p-3 font-bold text-indigo-700"
              [countAnim]="item.points"
              [countAnimDuration]="700"
            ></td>
            <td
              class="text-center p-3 font-semibold text-yellow-600"
              [countAnim]="item.gold"
            ></td>
            <td
              class="text-center p-3 font-semibold text-gray-500"
              [countAnim]="item.silver"
            ></td>
            <td
              class="text-center p-3 font-semibold text-orange-600"
              [countAnim]="item.bronze"
            ></td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Medal Standings (by medal hierarchy) -->
  <div class="space-y-3">
    <h2 class="text-3xl font-bold text-center sub-gradient-title">
      Medal Standings
    </h2>
    <p class="text-center text-xs text-slate-500">
      Sorted by ðŸ¥‡ then ðŸ¥ˆ then ðŸ¥‰
    </p>
    <div class="overflow-x-auto modern-card">
      <table class="min-w-full text-sm text-gray-700 table-modern">
        <thead class="bg-gray-100/70 text-gray-800 text-xs uppercase">
          <tr>
            <th class="text-left p-3">Rank</th>
            <th class="text-left p-3">College</th>
            <th class="p-3 text-center">ðŸ¥‡</th>
            <th class="p-3 text-center">ðŸ¥ˆ</th>
            <th class="p-3 text-center">ðŸ¥‰</th>
            <th class="p-3 text-center">Medal Sum</th>
          </tr>
        </thead>
        <tbody>
          @for (item of rows(); track item.id) {
          <tr
            class="border-t hover:bg-gray-50 transition"
            [class.bg-yellow-50]="item.rank === 1"
            [class.bg-gray-50]="item.rank === 2"
            [class.bg-orange-50]="item.rank === 3"
          >
            <td class="p-3">
              <span
                class="rank-badge rank-{{item.rank}}"
                [class.rank-1]="item.rank===1"
                [class.rank-2]="item.rank===2"
                [class.rank-3]="item.rank===3"
                >{{ item.rank }}</span
              >
            </td>
            <td class="p-3 flex items-center gap-2">
              <span
                class="w-3 h-3 rounded-full"
                [style.background]="item.color"
              ></span>
              {{ item.name }}
            </td>
            <td
              class="text-center p-3 font-semibold text-yellow-600"
              [countAnim]="item.gold"
            ></td>
            <td
              class="text-center p-3 font-semibold text-gray-500"
              [countAnim]="item.silver"
            ></td>
            <td
              class="text-center p-3 font-semibold text-orange-600"
              [countAnim]="item.bronze"
            ></td>
            <td
              class="text-center p-3 font-bold text-indigo-700"
              [countAnim]="item.total"
            ></td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <!-- Collapsible Categories / Events -->
  <div class="space-y-4">
    <div class="flex gap-2">
      <button
        (click)="expandAllCategories()"
        class="px-3 py-1 text-sm border rounded bg-white hover:bg-gray-50"
      >
        Expand All
      </button>
      <button
        (click)="collapseAllCategories()"
        class="px-3 py-1 text-sm border rounded bg-white hover:bg-gray-50"
      >
        Collapse All
      </button>
    </div>
    @for (cat of categories(); track cat.category) {
    <div class="modern-card">
      <button
        type="button"
        (click)="toggleCategory(cat.category)"
        class="w-full flex items-center justify-between px-4 py-3 text-left font-semibold hover:bg-gray-50 category-header"
      >
        <span>{{ cat.category }}</span>
        <span class="text-xs text-gray-500"
          >{{ cat.events.length }} events</span
        >
      </button>
      @if (isCategoryOpen(cat.category)) {
      <div class="border-t">
        @for (ev of cat.events; track ev.name) {
        <div class="border-b last:border-b-0 event-row">
          <button
            type="button"
            (click)="toggleEvent(ev.name)"
            class="w-full flex items-center justify-between px-6 py-2 text-left text-sm hover:bg-gray-50 transition-colors border-l-4 border-transparent"
            [class.bg-indigo-50]="isEventOpen(ev.name)"
            [class.border-indigo-500]="isEventOpen(ev.name)"
            [class.font-semibold]="isEventOpen(ev.name)"
          >
            <span class="font-medium">{{ ev.name }}</span>
            <span class="text-xs text-gray-400"
              >{{ ev.rows.length }} entries</span
            >
          </button>
          @if (isEventOpen(ev.name)) {
          <div class="px-6 pb-4 overflow-x-auto modern-card mt-2">
            <table class="min-w-full text-xs table-modern">
              <thead class="bg-gray-100/70 text-gray-600 uppercase">
                <tr>
                  <th class="p-2 text-left">Rank</th>
                  <th class="p-2 text-left">College</th>
                  <th class="p-2 text-center">ðŸ¥‡</th>
                  <th class="p-2 text-center">ðŸ¥ˆ</th>
                  <th class="p-2 text-center">ðŸ¥‰</th>
                  <th class="p-2 text-center">Points</th>
                </tr>
              </thead>
              <tbody>
                @for (row of ev.rows; track row.collegeId) {
                <tr class="border-t hover:bg-gray-50">
                  <td class="p-2 font-semibold">{{ row.rank }}</td>
                  <td class="p-2">{{ row.college }}</td>
                  <td
                    class="p-2 text-center text-yellow-600"
                    [countAnim]="row.gold"
                  ></td>
                  <td
                    class="p-2 text-center text-gray-500"
                    [countAnim]="row.silver"
                  ></td>
                  <td
                    class="p-2 text-center text-orange-600"
                    [countAnim]="row.bronze"
                  ></td>
                  <td
                    class="p-2 text-center font-semibold"
                    [countAnim]="row.points"
                  ></td>
                </tr>
                }
              </tbody>
            </table>
          </div>
          }
        </div>
        }
      </div>
      }
    </div>
    }
  </div>
</div>

@if (loading()) {
<div class="loading-state">Loading college...</div>
} @else if (error()) {
<div class="error-state">{{ error() }}</div>
} @else if (college()) { @let c = college();
<div class="details-shell" [style.--accent]="c?.color">
  <div class="header-bar">
    <a routerLink="/admin/colleges" class="back-link">Back</a>
    <div class="title-wrap">
      <h2
        class="title has-gradient"
        [style.background]="'linear-gradient(90deg,'+ (c?.color || '#6366f1') +', #8b5cf6)'"
      >
        {{ c?.name }}
      </h2>
      <span class="points-chip">Total Points: {{ totalPoints() }}</span>
    </div>
  </div>

  <form [formGroup]="form" (ngSubmit)="save()" class="groups-form">
    @for (group of groupedEvents(); track group.category) {
    <div class="category-panel" [class.expanded]="isExpanded(group.category)">
      <button
        type="button"
        class="category-toggle"
        (click)="toggleCategory(group.category)"
        [attr.aria-expanded]="isExpanded(group.category)"
      >
        <span class="cat-name">{{ group.category }}</span>
        <span class="meta">{{ group.events.length }} events</span>
        <span class="chevron" [class.rotate]="isExpanded(group.category)"
          >âŒ„</span
        >
      </button>
      @if (isExpanded(group.category)) {
      <div class="event-grid">
        @for (ev of group.events; track ev.key) {
        <div
          class="event-card"
          [ngClass]="{
                      'gold-card': form.get(ev.key)?.value === 5,
                      'silver-card': form.get(ev.key)?.value === 3,
                      'bronze-card': form.get(ev.key)?.value === 1,
                      'empty-card': form.get(ev.key)?.value !== 5 && form.get(ev.key)?.value !== 3 && form.get(ev.key)?.value !== 1
                    }"
        >
          <h3 class="event-title">{{ ev.key }}</h3>
          <div class="points-field">
            <label>Points</label>
            <input type="number" [formControlName]="ev.key" readonly />
          </div>
          <div class="medal-buttons">
            <button
              type="button"
              (click)="setMedal(ev.key, 'gold')"
              [class.inactive]="currentMedal(form.get(ev.key)?.value) !== 'gold'"
              class="medal-btn gold"
            >
              ðŸ¥‡ 5
            </button>
            <button
              type="button"
              (click)="setMedal(ev.key, 'silver')"
              [class.inactive]="currentMedal(form.get(ev.key)?.value) !== 'silver'"
              class="medal-btn silver"
            >
              ðŸ¥ˆ 3
            </button>
            <button
              type="button"
              (click)="setMedal(ev.key, 'bronze')"
              [class.inactive]="currentMedal(form.get(ev.key)?.value) !== 'bronze'"
              class="medal-btn bronze"
            >
              ðŸ¥‰ 1
            </button>
            <button
              type="button"
              (click)="setMedal(ev.key, 'none')"
              [class.inactive]="currentMedal(form.get(ev.key)?.value) !== 'none'"
              class="medal-btn clear"
            >
              âœ•
            </button>
          </div>
          <p class="players">Players: {{ ev.data.playerCount }}</p>
        </div>
        }
      </div>
      }
    </div>
    } @if (saving()) {
    <div class="saving">Saving...</div>
    }
  </form>
</div>
}
